{"ast":null,"code":"import { formatDate } from '@angular/common';\nimport { LOCALE_ID } from '@angular/core';\nimport { DtoMapperUtil } from \"../../../_CoreModule/utils/dto-mapper.util\";\nimport { TableItemsAnimations } from './items-table-animations';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/board.service\";\nimport * as i2 from \"../../../_CoreModule/services/websocket.service\";\nimport * as i3 from \"ngx-clipboard\";\nimport * as i4 from \"./../../../_SharedModule/modules/notification/notification.service\";\nimport * as i5 from \"./../../../_SharedModule/modules/translate/translate.service\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"../../../_SharedModule/modules/translate/translate.pipe\";\nfunction ItemsTableComponent_div_1_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 13)(1, \"span\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const item_r1 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r1.preview);\n  }\n}\nfunction ItemsTableComponent_div_1_span_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 14)(1, \"i\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const item_r1 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", item_r1.platform, \" \");\n  }\n}\nfunction ItemsTableComponent_div_1_span_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 14)(1, \"i\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const item_r1 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\" \", item_r1.deviceName, \" | \", item_r1.platform, \" \");\n  }\n}\nfunction ItemsTableComponent_div_1_button_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 15);\n    i0.ɵɵlistener(\"click\", function ItemsTableComponent_div_1_button_12_Template_button_click_0_listener($event) {\n      i0.ɵɵrestoreView(_r14);\n      const item_r1 = i0.ɵɵnextContext().$implicit;\n      const ctx_r12 = i0.ɵɵnextContext();\n      ctx_r12.loadWholeText(item_r1.id);\n      return i0.ɵɵresetView($event.stopPropagation());\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"t\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵproperty(\"@hideFullTextButtonAppendAnimation\", undefined);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(2, 2, \"board.page.itemsTable.hideFullText\"), \" \");\n  }\n}\nfunction ItemsTableComponent_div_1_div_16_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r17 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 16)(1, \"span\", 17);\n    i0.ɵɵlistener(\"click\", function ItemsTableComponent_div_1_div_16_Template_span_click_1_listener($event) {\n      i0.ɵɵrestoreView(_r17);\n      const item_r1 = i0.ɵɵnextContext().$implicit;\n      const ctx_r15 = i0.ɵɵnextContext();\n      ctx_r15.loadWholeText(item_r1.id);\n      return i0.ɵɵresetView($event.stopPropagation());\n    });\n    i0.ɵɵtext(2);\n    i0.ɵɵpipe(3, \"t\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(3, 1, \"board.page.itemsTable.more\"), \" \");\n  }\n}\nfunction ItemsTableComponent_div_1_div_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 18);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const item_r1 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", item_r1.text, \" \");\n  }\n}\nfunction ItemsTableComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r20 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 2)(1, \"div\", 3);\n    i0.ɵɵlistener(\"click\", function ItemsTableComponent_div_1_Template_div_click_1_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r20);\n      const item_r1 = restoredCtx.$implicit;\n      const ctx_r19 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r19.copyToClipboard(item_r1.id));\n    });\n    i0.ɵɵtemplate(2, ItemsTableComponent_div_1_div_2_Template, 3, 1, \"div\", 4);\n    i0.ɵɵelementStart(3, \"div\", 5)(4, \"div\", 6)(5, \"span\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"span\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(9, ItemsTableComponent_div_1_span_9_Template, 3, 1, \"span\", 7);\n    i0.ɵɵtemplate(10, ItemsTableComponent_div_1_span_10_Template, 3, 2, \"span\", 7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"div\", 8);\n    i0.ɵɵtemplate(12, ItemsTableComponent_div_1_button_12_Template, 3, 4, \"button\", 9);\n    i0.ɵɵelementStart(13, \"button\", 10);\n    i0.ɵɵlistener(\"click\", function ItemsTableComponent_div_1_Template_button_click_13_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r20);\n      const item_r1 = restoredCtx.$implicit;\n      const ctx_r21 = i0.ɵɵnextContext();\n      ctx_r21.deleteItem(item_r1.id);\n      return i0.ɵɵresetView($event.stopPropagation());\n    });\n    i0.ɵɵtext(14);\n    i0.ɵɵpipe(15, \"t\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵtemplate(16, ItemsTableComponent_div_1_div_16_Template, 4, 3, \"div\", 11);\n    i0.ɵɵtemplate(17, ItemsTableComponent_div_1_div_17_Template, 2, 1, \"div\", 12);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const item_r1 = ctx.$implicit;\n    const i_r2 = ctx.index;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"@tableItemAppendAnimation\", undefined)(\"ngClass\", ctx_r0.boardItemsJumpClass.get(item_r1.id) === true ? \"jump\" : \"\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"id\", \"item\" + item_r1.id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r0.boardItemsExtraTextVisibility[item_r1.id]);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", i_r2 + 1, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", item_r1.timestamp, \" \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", item_r1.deviceName === null);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", item_r1.deviceName !== null);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.boardItemsExtraTextVisibility[item_r1.id]);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(15, 12, \"board.page.itemsTable.delete\"), \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", item_r1.preview !== item_r1.text && !ctx_r0.boardItemsExtraTextVisibility[item_r1.id]);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", item_r1.preview !== item_r1.text && ctx_r0.boardItemsExtraTextVisibility[item_r1.id]);\n  }\n}\nexport let ItemsTableComponent = /*#__PURE__*/(() => {\n  class ItemsTableComponent {\n    constructor(boardService, websocketService, clipboardService, locale, notificationService, translateService) {\n      this.boardService = boardService;\n      this.websocketService = websocketService;\n      this.clipboardService = clipboardService;\n      this.locale = locale;\n      this.notificationService = notificationService;\n      this.translateService = translateService;\n      this.deviceNameFormatter = function (x) {\n        return x;\n      };\n      this.platformNameFormatter = function (x) {\n        return translateService.translate(\"board.page.platforms.\" + x);\n      };\n      this.mapper = new DtoMapperUtil();\n      // TODO sformatovat cas a odskusat deal so zonami a zimnym/letnym\n      // TODO lokalizacia formatu casu a datumu (America/EU verzia)\n      this.mapper.setRules({\n        status: null,\n        timestamp: x => formatDate(new Date(x), 'dd. MM. yyyy', this.locale),\n        deviceName: x => this.deviceNameFormatter(x),\n        platform: x => this.platformNameFormatter(x)\n      });\n      this.boardItems = {};\n      this.boardItemsExtraTextVisibility = {};\n      this.boardItemsJumpClass = new Map();\n    }\n    ngOnInit() {\n      console.log(\"on init board\");\n      this.refreshContent();\n      this.listenForChangeTrigger();\n    }\n    // TODO skontrolovat backend, vracat z nackendu aspon true alebo false pre\n    //  potvrdenie operacie\n    deleteItem(id) {\n      console.log(\"try to delete item: \" + id);\n      this.boardService.deleteItem(id).subscribe(data => {\n        console.log(data);\n      });\n    }\n    copyToClipboard(id) {\n      console.log(\"copied to clipboard\");\n      this.clipboardService.copyFromContent(this.getTextById(id));\n      this.triggerCopyAnimation(id);\n      this.notificationService.notify(this.translateService.translate(\"board.page.notifications.textCopied.part1\") + \" #\" + this.getItemOrderById(id) + \" \" + this.translateService.translate(\"board.page.notifications.textCopied.part2\"));\n    }\n    loadWholeText(id) {\n      this.boardItemsExtraTextVisibility[id] = !this.boardItemsExtraTextVisibility[id];\n    }\n    refreshContent() {\n      this.boardService.getItems().subscribe(data => {\n        if (this.boardItems.items === undefined) {\n          // first run\n          let totok = this;\n          this.boardItems.items = data.items.map(item => this.mapper.remap(item));\n          this.boardItems.items.forEach(function (item) {\n            totok.boardItemsExtraTextVisibility[item.id] = false;\n          });\n        } else {\n          // delete case\n          let newItemsIds = data.items.map(d => d.id);\n          this.boardItems.items = this.boardItems.items.filter(i => newItemsIds.indexOf(i.id) !== -1);\n          // add case\n          let currentItemsIds = this.boardItems.items.map(i => i.id);\n          data.items.filter(i => currentItemsIds.indexOf(i.id) === -1).map(item => this.mapper.remap(item)).forEach(item => {\n            this.boardItems.items.unshift(item);\n          });\n        }\n        console.log(this.boardItems.items);\n      });\n    }\n    listenForChangeTrigger() {\n      this.websocketService.getWebSocket().subscribe(msg => {\n        this.refreshContent();\n        console.log('message received: ' + msg.autosync);\n      }, err => {\n        console.log('message received: ' + err);\n        this.listenForChangeTrigger(); // subscribing ends for some reason after around minute, recall\n      }, () => {\n        console.log('socket connection closed');\n      });\n    }\n    getTextById(id) {\n      let result = \"\";\n      this.boardItems.items.forEach(function (bi) {\n        if (bi.id === id) {\n          result = bi.text;\n        }\n      });\n      return result;\n    }\n    getItemOrderById(id) {\n      let i = -1;\n      for (let boardItem of this.boardItems.items) {\n        i++;\n        if (boardItem.id === id) {\n          break;\n        }\n      }\n      return i + 1;\n    }\n    triggerCopyAnimation(id) {\n      let jumpClass = this.boardItemsJumpClass.get(id);\n      if (jumpClass !== true) {\n        this.boardItemsJumpClass.set(id, true);\n        let totok = this;\n        setTimeout(function () {\n          totok.boardItemsJumpClass.set(id, false);\n        }, 500);\n      }\n    }\n  }\n  ItemsTableComponent.ɵfac = function ItemsTableComponent_Factory(t) {\n    return new (t || ItemsTableComponent)(i0.ɵɵdirectiveInject(i1.BoardService), i0.ɵɵdirectiveInject(i2.WebsocketService), i0.ɵɵdirectiveInject(i3.ClipboardService), i0.ɵɵdirectiveInject(LOCALE_ID), i0.ɵɵdirectiveInject(i4.NotificationService), i0.ɵɵdirectiveInject(i5.TranslateService));\n  };\n  ItemsTableComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ItemsTableComponent,\n    selectors: [[\"app-board-items-list\"]],\n    decls: 2,\n    vars: 1,\n    consts: [[\"id\", \"boardItems\"], [3, \"ngClass\", 4, \"ngFor\", \"ngForOf\"], [3, \"ngClass\"], [3, \"id\", \"click\"], [\"class\", \"itemBaseSection\", 4, \"ngIf\"], [1, \"itemButtonsSection\"], [1, \"left\"], [\"class\", \"deviceString\", 4, \"ngIf\"], [1, \"right\"], [\"class\", \"hideFullText\", 3, \"click\", 4, \"ngIf\"], [1, \"deleteItem\", 3, \"click\"], [\"class\", \"itemMoreSection separatingLine\", 4, \"ngIf\"], [\"class\", \"itemFulltextSection\", 4, \"ngIf\"], [1, \"itemBaseSection\"], [1, \"deviceString\"], [1, \"hideFullText\", 3, \"click\"], [1, \"itemMoreSection\", \"separatingLine\"], [3, \"click\"], [1, \"itemFulltextSection\"]],\n    template: function ItemsTableComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"section\", 0);\n        i0.ɵɵtemplate(1, ItemsTableComponent_div_1_Template, 18, 14, \"div\", 1);\n        i0.ɵɵelementEnd();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngForOf\", ctx.boardItems.items);\n      }\n    },\n    dependencies: [i6.NgClass, i6.NgForOf, i6.NgIf, i7.TranslationPipe],\n    styles: [\"section#boardItems[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{overflow:hidden;cursor:pointer;transition:transform .125s ease-in-out,opacity .125s ease-in-out}section#boardItems[_ngcontent-%COMP%] > div.jump[_ngcontent-%COMP%]{transform:scale(2);opacity:0}section#boardItems[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{padding:.25em;margin:.25em 0;border-radius:.25em;background-color:#b0ddff;position:relative;min-height:3em;transition:background-color .25s ease-in-out}section#boardItems[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   div.itemButtonsSection[_ngcontent-%COMP%]{position:absolute;top:.3125em;right:.3125em;left:.3125em;opacity:0;transition:opacity .25s ease-in-out}section#boardItems[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   div.itemButtonsSection[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:inline-block;line-height:2.25em}section#boardItems[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   div.itemButtonsSection[_ngcontent-%COMP%]   div.left[_ngcontent-%COMP%]{float:left}section#boardItems[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   div.itemButtonsSection[_ngcontent-%COMP%]   div.right[_ngcontent-%COMP%]{float:right;opacity:.9}section#boardItems[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   div.itemButtonsSection[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:2em;font-weight:700}section#boardItems[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   div.itemButtonsSection[_ngcontent-%COMP%]   button.deleteItem[_ngcontent-%COMP%]:hover{background-color:#d00;color:#fff}section#boardItems[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   div.itemButtonsSection[_ngcontent-%COMP%]   button.hideFullText[_ngcontent-%COMP%]:hover{background-color:#fff;color:#000}section#boardItems[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   div.itemButtonsSection[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{position:relative;display:inline-block;vertical-align:middle;color:#000;font-weight:700;line-height:1.5em;border-radius:3em;padding:0 .5em;margin:0 .25em;overflow:hidden;z-index:2}section#boardItems[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   div.itemButtonsSection[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-weight:400;font-size:.75em}section#boardItems[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   div.itemButtonsSection[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:after{display:block;z-index:-1;content:\\\"\\\";position:absolute;inset:0;opacity:.9;background-color:#ebf6ff}section#boardItems[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   div.itemBaseSection[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{word-break:break-word}section#boardItems[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:hover{background-color:#7cc6fe}section#boardItems[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:hover   div.itemButtonsSection[_ngcontent-%COMP%]{opacity:1}section#boardItems[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   div.itemMoreSection[_ngcontent-%COMP%]{margin-top:.125em;padding-top:.125em;text-align:center}section#boardItems[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   div.itemMoreSection[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-top:.25em;display:block;font-weight:700;cursor:pointer}section#boardItems[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   div.itemMoreSection[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration:underline}@media only screen and (max-width: 640px){section#boardItems[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{padding-right:3em}section#boardItems[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   div.itemButtonsSection[_ngcontent-%COMP%]   div.left[_ngcontent-%COMP%]   span.deviceString[_ngcontent-%COMP%]{display:none}}@media (pointer: none),(pointer: coarse){section#boardItems[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{padding-right:3em}section#boardItems[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   div.itemButtonsSection[_ngcontent-%COMP%]{opacity:1}section#boardItems[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   div.itemButtonsSection[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{opacity:1}section#boardItems[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   div.itemButtonsSection[_ngcontent-%COMP%]   div.left[_ngcontent-%COMP%]{display:none}}\"],\n    data: {\n      animation: [TableItemsAnimations.tableItemAppendAnimation, TableItemsAnimations.hideFullTextButtonAppendAnimation]\n    }\n  });\n  return ItemsTableComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}